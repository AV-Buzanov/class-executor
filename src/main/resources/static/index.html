<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Java class executor</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script>
        window.onload = function () {
            document.getElementById("send").onclick = function fun() {
                var body = document.forms["myForm"]["code"].value;
                var input = document.forms["myForm"]["input"].value;
                var args = document.forms["myForm"]["args"].value;

                const inputRows = input.split(/\r\n|\r|\n/g);
                const argsRows = args.split(/\r\n|\r|\n/g);

                if (body == "") {
                    alert("Нельзя отправить пустое сообщение!");
                } else {
                    var url = "https://class-executor.herokuapp.com/api/java/compile";
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', url, true);
                    xhr.setRequestHeader("Origin", "class-executor.herokuapp.com");
                    xhr.setRequestHeader("Content-type", "text/plain");

                    function iterateInput(item, index) {
                        console.log(item);
                        xhr.setRequestHeader("input", item);
                    }

                    function iterateArgs(item, index) {
                        console.log(item);
                        xhr.setRequestHeader("args", item);
                    }

                    inputRows.forEach(iterateInput);
                    argsRows.forEach(iterateArgs);

                    xhr.send(body);
                    xhr.onprogress = function progressRequest(e){
                        printAnswer("Выполняется...");
                    }
                    xhr.onreadystatechange = function processRequest(e) {
                        var answ;
                        if (xhr.readyState == XMLHttpRequest.DONE) {
                            if (xhr.status != 200 && xhr.response == "")
                                answ = "Сервер не отвечает";
                            else
                                answ = xhr.response;
                        }
                        printAnswer(answ);
                    }

                    function printAnswer(answ) {
                        var el = document.forms["myForm"]["answer"];
                        if (typeof el.innerText !== 'undefined') {
                            // IE8-
                            el.innerText = answ;
                        } else {
                            // Нормальные браузеры
                            el.textContent = answ;
                        }
                    }


                }
            }
        }
    </script>
</head>
<body>
<div class="container" style="text-align: left;width: 50%;float: contour;padding: 15px;margin: 0 auto;">
    <form name="myForm">
        <label for="code">Java код (с импортами и объявлением класса):</label>
        <textarea class="form-control" id="code" name="code" rows="15" cols="100"
                  placeholder="Код"></textarea>
        <br>
        <label for="input">Данные в System.in:</label>

        <textarea class="form-control" id="input" name="input" rows="3" cols="100"
                  placeholder="Входной поток"></textarea>
        <br>
        <label for="args">Аргументы (args):</label>

        <textarea class="form-control" id="args" name="args" rows="3" cols="100"
                  placeholder="Аргументы"></textarea>
        <br>
        <label for="answer">Вывод консоли: </label>

        <textarea class="form-control" id="answer" name="answer" rows="5" cols="100" readonly
                  placeholder="Ответ"></textarea>
        <br>
        <button type="button" id="send" class="btn btn-primary btn-lg">Выполнить</button>
    </form>
</div>
</body>
</html>